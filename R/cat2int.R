#' Parse integer encoding for category variable in SQL
#'
#' @export
#' @examples
#' \dontrun{library(RODBC)}
#' \dontrun{impala <- odbcConnect("Impala")}
#' \dontrun{output_cat2int <- cat2int(feature = "cyl", table = "opd.sqlsave_test_ljx")}

cat2int <- function(feature = 'feature', table = 'table'){

    # library all required pkgs
    library(tidyverse)

    sqlQuery(impala, glue::glue("select distinct {feature} from {table} order by {feature}")) -> df

    df[,'feature2'] <- df[,feature]
    df$level <- as.integer(df[,feature])

    df %>%
        mutate(
            text = glue::glue("when {feature} = '{feature2}' then {level}")
        ) %>%
        summarise(
            text = str_flatten(text, "\n\t")
        ) %>%
        mutate(text = glue::glue("case {text} end as {feature}")) %>%
        mutate(text = str_replace_all(text, "= 'NA' then NA", "is NULL then NULL")) %>%
        pull -> text
    return(text)
}
